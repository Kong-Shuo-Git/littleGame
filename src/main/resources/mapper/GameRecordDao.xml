<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.game.dao.GameRecordDao">
    <!-- 插入游戏记录 -->
    <insert id="insert" parameterType="org.example.game.pojo.GameRecord" useGeneratedKeys="true" keyProperty="recordId">
        INSERT INTO game_record (user_id, game_type, score, level, duration, create_time)
        VALUES (#{userId}, #{gameType}, #{score}, #{level}, #{duration}, #{createTime})
    </insert>
    <!-- 根据用户ID查询游戏记录 -->
    <select id="findByUserId" resultType="org.example.game.pojo.GameRecord">
        SELECT record_id   as recordId,
               user_id     as userId,
               game_type   as gameType,
               score,
               level,
               duration,
               create_time as createTime
        FROM game_record
        WHERE user_id = #{userId}
        ORDER BY create_time DESC
    </select>
    <!-- 根据游戏类型和用户ID查询最高分数 -->
    <select id="findHighestScoreByGameType" resultType="org.example.game.pojo.GameRecord">
        SELECT record_id   as recordId,
               user_id     as userId,
               game_type   as gameType,
               score,
               level,
               duration,
               create_time as createTime
        FROM game_record
        WHERE user_id = #{param1}
          AND game_type = #{param2}
        ORDER BY score DESC
        LIMIT 1
    </select>
    <!-- 查询游戏类型的排行榜 -->
    <select id="findTopScoresByGameType" resultType="org.example.game.pojo.GameRecord">
        SELECT gr.record_id   as recordId,
               gr.user_id     as userId,
               gr.game_type   as gameType,
               gr.score,
               gr.level,
               gr.duration,
               gr.create_time as createTime
        FROM game_record gr
                 JOIN (SELECT user_id, MAX(score) as max_score
                       FROM game_record
                       WHERE game_type = #{param1}
                       GROUP BY user_id) t ON gr.user_id = t.user_id AND gr.score = t.max_score
        WHERE gr.game_type = #{param1}
        ORDER BY gr.score DESC
        LIMIT #{param2}
    </select>
</mapper>